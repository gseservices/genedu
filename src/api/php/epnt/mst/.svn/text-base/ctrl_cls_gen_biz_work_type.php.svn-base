<?php
require_once '.\..\..\app_const.php';
include_once BASE_PATH . '\classes\masters\cls_client_work_planner.php';

$action=$_REQUEST["a"];
//global $obj;
$obj = new cls_gen_biz_work_type() ;

switch($action)
{
	//Add Records
	case "a":

		$obj->m_pk_work_type_id= $_REQUEST["pk_work_type_id"] ;
		$obj->m_fk_uk_department_code= $_REQUEST["fk_uk_department_code"] ;
		$obj->m_uk_work_type_code= $_REQUEST["uk_work_type_code"] ;
		$obj->m_work_name= $_REQUEST["work_name"] ;
		$obj->m_helpfile_link= $_REQUEST["helpfile_link"] ;
		$obj->m_description= $_REQUEST["description"] ;
		$obj->m_fees= $_REQUEST["fees"] ;
		$obj->m_fees_description= $_REQUEST["fees_description"] ;

		$jsonData = $_REQUEST["p_xml"];

		$keys[0]="pk_work_step_id";
		$keys[1]="uk_work_step_code";
		$keys[2]="work_step_name";
		$keys[3]="parent_code";
		$keys[4]="is_milestone";
		$keys[5]="perc_progress";
		$keys[6]="is_nested";
		$keys[7]="helpfile_link";
		$keys[8]="description";

		//$obj->m_p_xml=$obj->prepareXMLForSP(htmlspecialchars_decode ($jsonData),"mst_biz_work_step" , $keys,$obj->logged_in_user_id);
		$p_xml= '"'.$obj->prepareXMLForSP(htmlspecialchars_decode ($jsonData),"mst_biz_work_step" , $keys,$obj->logged_in_user_id).'"';
		$obj->m_p_xml= $p_xml;
		echo $p_xml;
		echo  $obj->prepareXMLForSP(htmlspecialchars_decode ($jsonData),"mst_biz_work_step" , $keys,$obj->logged_in_user_id);
		$obj->m_isnested = "N";
			
		$ret = $obj->Add();
		echo ("valret". $ret);
		if(intval($ret)>0){
			echo  $ret;
		}else{
			echo "FAIL";
		}
		//alert("InAdd");
		break;
		//Edit Records
	case "e":
		//$ret = $obj->GetData(SELECT_MODE_TABLE, SELECT_RETURN_TYPE_JSONSTRING, "mst_biz_document_category","*","");
		break;
		//Delete Records
	case "d":
		$obj->m_pk_work_type_id= $_REQUEST["pk_work_type_id"] ;
		$obj->m_deleted_by=$_REQUEST["deleted_by"];
		$obj->m_deletedtype="s";

		$ret = $obj->Delete();
		echo $ret;
		if(intval($ret)>0){
			echo  $ret;
		}else{
			echo "FAIL";
		}

		break;
	case "r":		
		$ret = $obj->GetData(SELECT_MODE_TABLE, SELECT_RETURN_TYPE_JSONSTRING, "vm_for_work_step GROUP BY pk_work_type_id","*","");
		echo  $ret;
		break;
	case "f":
		$filter ="";
		if(isset($_REQUEST["workType_filter"])){
			$filter = htmlspecialchars_decode($_REQUEST["client_filter"]);
		}
		$ret = $obj->GetData(SELECT_MODE_TABLE, SELECT_RETURN_TYPE_JSONSTRING, "vm_for_work_step","*","$filter");
		echo  $ret;
		break;
	case "p":
		$ret = $obj->getAllMastersRequired();
		echo  $ret;
		break;
}

function debug($str=""){
	echo $str ."<br>";
}

?>